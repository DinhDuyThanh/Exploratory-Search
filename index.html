
<!--
Author: Dinh Duy Thanh
-->
<!DOCTYPE HTML>
<html>
	<head>
		<title>Expolatory Search</title>
		<meta http-equiv=Content-Type content ="text/html"; charset="utf-8">
		<link href="css/style.css" rel='stylesheet' type='text/css' />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/x-icon" href="images/fav-icon.png" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
		</script>
		<script type="text/javascript">
		//alert = function(){};
		window.onerror=function(msg, url, linenumber){
			alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber)
			return true
		}
		function getAllType(){
			var arrType = [];
			prefix ="http://www.linkedmdb.org/sparql?query=PREFIX+owl%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX+oddlinker%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Foddlinker%2F%3E%0D%0APREFIX+map%3A+%3Cfile%3A%2FC%3A%2Fd2r-server-0.4%2Fmapping.n3%23%3E%0D%0APREFIX+db%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2F%3E%0D%0APREFIX+dbpedia%3A+%3Chttp%3A%2F%2Fdbpedia.org%2Fproperty%2F%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX+dc%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+movie%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Fmovie%2F%3E%0D%0A";
			var query = "SELECT distinct ?o WHERE {?s rdf:type ?o}";	
			var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
			$.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: "jsonp",
				beforeSend: function (jqXHR) {
				},
				success:function(data, textStatus, jqXHR){			
				var arr = data['results']['bindings'];
				for(var i=0;i<arr.length;i++)
					if(arr[i]['o']['value'].search("linkedmdb")!=-1){
						var tmp = arr[i]['o']['value'].replace("http://data.linkedmdb.org/resource/movie/","");
						tmp = tmp.replace("http://data.linkedmdb.org/resource/oddlinker/","");
						var tmp1 = tmp.replace(/_/g," ");
						arrType.push({key:tmp,value:tmp1});
					}
					$("#allType").html(JSON.stringify(arrType));
				}
			});			
			
		}
		//	getAllType();
		</script>
		<!----webfonts---->
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
		<!----//webfonts---->
		<!-- Global CSS for the page and tiles -->
  		<link rel="stylesheet" href="css/main.css">
  		<!-- //Global CSS for the page and tiles -->
		<!---start-click-drop-down-menu----->
		<script src="js/jquery.min.js"></script>
        <!----start-dropdown--->
         <script type="text/javascript">
			var $ = jQuery.noConflict();
				$(function() {
					$('#activator').click(function(){
						window.location = 'http://exploratorysearch.esy.es/';
						//$('#box').animate({'top':'0px'},500);
					});
					$('#boxclose').click(function(){
					$('#box').animate({'top':'-700px'},500);
					});
				});
				$(document).ready(function(){
				//Hide (Collapse) the toggle containers on load
				$(".toggle_container").hide(); 
				//Switch the "Open" and "Close" state per click then slide up/down (depending on open/close state)
				$(".trigger").click(function(){
					$(this).toggleClass("active").next().slideToggle("slow");
						return false; //Prevent the browser jump to the link anchor
				});
									
			});
		</script>
        <!----//End-dropdown--->
		<!---//End-click-drop-down-menu----->
		<script>
		
		//Kiem tra xem tu co phai stop Word khong
		function checkStopWord(word){
			
				var stopWord =["a","about","above","after","again","against","all","am","an","and","any","are","aren't","as",
					"at","be","because","been","before","being","below","between","both","but","by","can't","cannot","could",
					"couldn't","did","didn't","do","does","doesn't","doing","don't","down","during","each","few","for","from",
					"further","had","hadn't","has","hasn't","have","haven't","having","he","he'd","he'll","he's","her",
					"here","here's","hers","herself","him","himself","his","how","how's","i","i'd","i'll","i'm","i've","if","in","into","is","isn't","it","it's","its","itself","let's","me","more","most","mustn't","my","myself","no","nor","not","of","off","on","once","only","or","other","ought","our","ours", 	"ourselves","out","over","own","same","shan't","she","she'd","she'll","she's","should","shouldn't","so","some","such","than","that","that's","the","their","theirs","them","themselves","then","there","there's","these","they","they'd","they'll","they're","they've","this","those","through","to","too","under","until","up","very","was","wasn't","we","we'd","we'll","we're","we've","were","weren't","what","what's","when","when's","where","where's","which","while","who","who's","whom","why","why's","with","won't","would","wouldn't","you","you'd","you'll","you're","you've","your","yours","yourself","yourselves"
				];
			for(var i=0;i<stopWord.length;i++)
				if(stopWord[i] == word)
					return true;
				return false;
	}
		
	//mo rong truy van voi uri va kieu dau vao
		function getInfoFromType(key, type){
		if(type=="movie:film"){
			type=key.replace("http://data.linkedmdb.org/resource/","");
			var ind = parseInt(type.indexOf("\/"));
			type = type.slice(0,ind);
			type="movie:"+type;
			//alert(type+key);
		}
		//thay doi noi dung
		if(type=="movie:content_rating"){
			type="movie:rating";
		}
		if(type=="movie:country"){
			type="oddlinker:link_source";
		}
		if(type=="movie:film_costume_designer"){
			type="movie:costume_designer";
		}
		if(type=="movie:film_crew_gig"){
			type="movie:film_crew_gig_film";
		}
		if(type=="movie:film_genre"){
			type="movie:genre";
		}
		if(type=="movie:film_crew_gig_film_job"){
			type="movie:film_job";
		}
		if(type=="movie:film_location"){
			type="movie:featured_film_location";
		}
		if(type=="movie:special_film_performance_type"){
			type=="movie:performance_special_performance_type";
		}
			prefix ="http://www.linkedmdb.org/sparql?query=PREFIX+owl%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX+oddlinker%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Foddlinker%2F%3E%0D%0APREFIX+map%3A+%3Cfile%3A%2FC%3A%2Fd2r-server-0.4%2Fmapping.n3%23%3E%0D%0APREFIX+db%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2F%3E%0D%0APREFIX+dbpedia%3A+%3Chttp%3A%2F%2Fdbpedia.org%2Fproperty%2F%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX+dc%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+movie%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Fmovie%2F%3E%0D%0A";
			var query = "SELECT * WHERE {{<"+key+"> "+type+" ?s}UNION{?s "+type+"<"+key+"> }. ?s foaf:page ?url}";	
			//alert(query);
			var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
		//$("#functionAResult").append(uri+"</br>");
				//alert(query);
							$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: "jsonp",
									beforeSend: function (jqXHR) {
													jqXHR.key = "aa";
									},
									success:function(data, textStatus, jqXHR){	
									
									document.getElementById("loading").style.display = 'none';
									$("#abc").fadeIn("slow");
									$(".alert-box").fadeOut();
									
									//$("#abc").append(JSON.stringify(data));
								 		var arr = data['results']['bindings'];
									 for(var i=0;i<arr.length;i++)
										if(arr[i]['url']['value'].search("freebase")!=-1){
											//alert(arr[i]['s']['value']);
											var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
											var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
											 $.ajax({
												type:     "GET",
												url:      uri, // <-- Here
												dataType: 'json',
												beforeSend: function (jqXHR) {
																jqXHR.key = arr[i]['s']['value'];
																jqXHR.uri = uri;
												},
												success:function(data, textStatus, jqXHR){	
												var name,img,type,des;
												type="";												
												if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage"/></div>'; 
												//img = ""; 
												//img = data.property['/type/object/name'].values[0].text;
												if(name!=""&&des!="")
												str = '<li><div class="post-info">'
														+img
														+'<div class="post-basic-info">'
														+'	<h3><a href="#" onclick="showPopup1(\''+jqXHR.uri+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
														+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
														+'	<span><a href="#"><label> </label>'+type+'</a></span>'
														+'	<p>'+des+'</p>'
														+'</div>'
													+'</div>'
												+'</li>';
												else str="";
													$("#top_box").show();
													var rawtmp = $("#rawtop").html();
													if(rawtmp.search(jqXHR.key)==-1){													
													$("#topsearch").prepend(str);
													$("#rawtop").append(" "+jqXHR.key);
													}											
												} 
											});	 
										}
									 } 
								});	
				
		}
		
	//
		function readEqualEntity(data,arrType){
			$("#abc").fadeIn("slow");
									$(".alert-box").fadeOut();
								 		var arr = data['results']['bindings'];
									 for(var i=0;i<arr.length;i++)
										if(arr[i]['url']['value'].search("freebase")!=-1){
											//alert(arr[i]['s']['value']);
											if(arrType.length>0)
											for(var j=0;j<arrType.length;j++)
											{
												getInfoFromType(arr[i]['s']['value'], arrType[j].type);
											}
											var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
											var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
											 $.ajax({
												type:     "GET",
												url:      uri, // <-- Here
												dataType: 'json',
												beforeSend: function (jqXHR) {
																jqXHR.key = arr[i]['s']['value'];
																jqXHR.name = arr[i]['label']['value'];
																jqXHR.uri = uri;
												},
												success:function(data, textStatus, jqXHR){	
												var name,img,type,des;
												type="";
												if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												if(name!=""&&des!="")
												str = '<li><div class="post-info">'
														+img
														+'<div class="post-basic-info">'
														+'	<h3><a href="#" onclick="showPopup1(\''+jqXHR.uri+'\',\''+jqXHR.key+'\');" >'+jqXHR.name+'</a>'
														+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
														+'	<span><a href="#"><label> </label>'+type+'</a></span>'
														+'	<p>'+des+'</p>'
														+'</div>'
													+'</div>'
												+'</li>';
												else if(name.search("character"))
													str = '<li><div class="post-info">'
														+img
														+'<div class="post-basic-info">'
														+'	<h3><a href="#" onclick="showPopup1(\''+jqXHR.uri+'\',\''+jqXHR.key+'\');" >'+jqXHR.name+'</a>'
														+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(jqXHR.name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
														+'	<span><a href="#"><label> </label>\"Film character\"</a></span>'
														+'	<p>...</p>'
														+'</div>'
													+'</div>'
												+'</li>';
												else str="";
												
													$("#top_box").show();
													var rawtmp = $("#rawtop").html();
													if(rawtmp.search(jqXHR.key)==-1){
													if(img!="")
														$("#topsearch").prepend(str);
													else
														$("#topsearch").append(str);
													$("#rawtop").append(" "+jqXHR.key);
													//alert(jqXHR.key);
													}
																					
												} 
											});	 
										
		}
		}
		//Phan tich va tim kiem thuc the
			function search(type){
			$("#fast_box").fadeOut();
			$("#wiki_box").fadeOut();
			$("#loading").fadeIn("slow");
			
				$("#topsearch").html("");			
				$("#allsearch").html("");
				$("#rawtop").html("");
				$("#rawrecommend").html("");
				document.getElementById("abc").style.display = 'none';
				str = document.getElementById("text_search").value;
				prefix ="http://www.linkedmdb.org/sparql?query=PREFIX+owl%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX+oddlinker%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Foddlinker%2F%3E%0D%0APREFIX+map%3A+%3Cfile%3A%2FC%3A%2Fd2r-server-0.4%2Fmapping.n3%23%3E%0D%0APREFIX+db%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2F%3E%0D%0APREFIX+dbpedia%3A+%3Chttp%3A%2F%2Fdbpedia.org%2Fproperty%2F%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX+dc%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+movie%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Fmovie%2F%3E%0D%0A";
				var arrKey = [];
				var arrType = [];
				var res = str.split(" ");
				var count=0;
				for(var i=0;i<res.length;i++){
					if(i+2<res.length)
						arrKey.push({key:count++,value:res[i]+" "+res[i+1]+" "+res[i+2]});
					if(i+1<res.length)
						arrKey.push({key:count++,value:res[i]+" "+res[i+1]});
						if(res[i]!="film")
					arrKey.push({key:count++,value:res[i]});	
				}
				//module mo rong tu tim kiem voi cac tu khoa de xac dinh kieu
				var json = $("#allType").html();
				var arrTypeInput = JSON.parse(json);
				//alert(JSON.stringify(arrType));
				for(var j=0;j<arrTypeInput.length;j++)
					for(var i=0;i<arrKey.length;i++){
						if(checkStopWord(arrKey[i].value)) continue;
						
							if(arrTypeInput[j].value.search(arrKey[i].value)!=-1){
								arrType.push({type:"movie:"+arrTypeInput[j].key});
							}
				}
				//alert(JSON.stringify(arrTypeInput.length));
				//alert(arrType.length);
				//tim kiem thuc the
				for(var i=0;i<arrKey.length;i++){
				if(checkStopWord(arrKey[i].value)) continue;
				//	Tim kiem thuc the chinh xac	
			  // var query = "SELECT * WHERE { {{?s dc:title '"+arrKey[i].value+"'}";
			 //  for(var k=0;k<arrTypeInput.length;k++)
			//	var query = query+" UNION {?s movie:"+arrTypeInput[k].key+"_name '"+arrKey[i].value+"'}";
			 //  query = query +"}. ?s foaf:page ?url.?s rdfs:label ?label}";
			  var query = "SELECT * WHERE { {{?s dc:title '"+arrKey[i].value+"'} UNION {?s movie:actor_name '"+arrKey[i].value+"'} UNION {?s movie:editor_name '"+arrKey[i].value+"'} UNION {?s movie:director_name '"+arrKey[i].value+"'} UNION {?s movie:writer_name '"+arrKey[i].value+"'} UNION {?s movie:producer_name '"+arrKey[i].value+"'} UNION {?s movie:film_character_name '"+arrKey[i].value+"'} UNION {?s movie:film_genre_name '"+arrKey[i].value+"'}}. ?s foaf:page ?url.?s rdfs:label ?label}";		
			var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
			//$("#functionAResult").html(query);
							$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: "jsonp",
									beforeSend: function (jqXHR) {
													jqXHR.key = arrKey[i].value;
									},
									success:function(data, textStatus, jqXHR){									
									document.getElementById("loading").style.display = 'none';
									readEqualEntity(data,arrType);
									}
									  
								});	
								
	
				//tim kiem thuc the mo rong
				var query = "SELECT * WHERE { ?s rdfs:label ?o . FILTER regex(?o, '"+res[i]+"','i'). ?s foaf:page ?url} limit 16";	
				var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
							$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: "jsonp",
									beforeSend: function (jqXHR) {
													jqXHR.key = "aa";
									},
									success:function(data, textStatus, jqXHR){	
									
									document.getElementById("loading").style.display = 'none';
									$("#abc").fadeIn("slow");
									
									//$("#abc").append(JSON.stringify(data));
									var arr;
									if(data['results']['bindings']!= undefined)
								 		arr = data['results']['bindings'];
									 for(var i=0;i<arr.length;i++)
										if(arr[i]['url']['value'].search("freebase")!=-1){
											//alert(arr[i]['s']['value']);
											var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
											var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
											 $.ajax({
												type:     "GET",
												url:      uri, // <-- Here
												dataType: 'json',
												beforeSend: function (jqXHR) {
																jqXHR.key = arr[i]['s']['value'];
																jqXHR.uri = uri;
												},
												success:function(data, textStatus, jqXHR){	
												var name,img,type,des;
												type="";												
												if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="...";
												if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												//img = ""; 
												//img = data.property['/type/object/name'].values[0].text;
												if(name!="")
												str = '<li><div class="post-info">'
														+img
														+'<div class="post-basic-info">'
														+'	<h3><a href="#" onclick="showPopup1(\''+jqXHR.uri+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
														+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
														+'	<span><a href="#"><label> </label>'+type+'</a></span>'
														+'	<p>'+des+'</p>'
														+'</div>'
													+'</div>'
												+'</li>';
												else str="";
												$("#all_box").show();
												var rawtmp = $("#rawrecommend").html();
													if(rawtmp.search(jqXHR.key)==-1){
													
													if(img!="")
														$("#allsearch").prepend(str);
													else
														$("#allsearch").append(str);	
													$("#rawrecommend").append(" "+jqXHR.key);
													}							
												} 
											});	 
										}
									 } 
								});					
				
				}
			}
			
		//	
			function start(){
				document.getElementById("top_search").style.display = 'block';
				$("#a-start").fadeOut();
			}	
	
			function searchType(key,type){
				$("#loading").fadeIn("slow");
				//$("#keySA").html("");
				document.getElementById("abc").style.display = 'none';
				str = document.getElementById("text_search").value;
				if(type==100){
					str=key;
					key="";
				}
				$.ajax({
				type:"get",
				url:"src/sparql_query.php",
				data:"type="+type+"&text="+str+"&key="+key,
				async:true,
				success:function(kq){
				document.getElementById("loading").style.display = 'none';
				$("#abc").fadeIn("slow");				
				$("#abc").html(kq);
				document.getElementById("more").style.display = 'block';
				}
				})
				
				$.ajax({
				type:"get",
				url:"src/sparql_query1.php",
				data:"type="+type+"&text="+str+"&key="+key,
				async:true,
				success:function(kq){			
				$("#abc").html(kq);
				}
				})
			}

			</script>

<script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js"></script>
<script language="javascript" >
var slider;
$(document).ready(function(){
	(function($){
		$.fn.absoluteCenter = function(){
			this.each(function(){
				var top = -($(this).outerHeight() / 2)+'px';
				var left = -($(this).outerWidth() / 2)+'px';
				$(this).css({'position':'absolute', 'position':'fixed', 'margin-top':top, 'margin-left':left, 'top':'50%', 'left':'50%'});
				return this;
			});
		}
	})(jQuery);
	
	$('a#show-popup').click(function(){
		//Ð?t bi?n cho các d?i tu?ng d? g?i d? dàng
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		//Hi?n các d?i tu?ng
		bg.animate({opacity:0.2},0).fadeIn(1000); //cho n?n trong su?t
		obj.fadeIn(1000).draggable({cursor:'move',handle:'#popup-header'}).absoluteCenter(); //can gi?a popup và thêm draggable c?a jquery UI cho ph?n header c?a popup
		//Ðóng popup khi nh?n nút
		btnClose.click(function(){
			bg.fadeOut(1000);
			obj.fadeOut(1000);
		});
		//Ðóng popup khi nh?n background
		bg.click(function(){
			btnClose.click(); //K? th?a nút dóng ? trên
		});
		//Ðóng popup khi nh?n nút Esc trên bàn phím
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); //K? th?a nút dóng ? trên
			}
		});
		return false;
	});
	
	           slider = $("#bxslider").bxSlider({
    slideWidth: 200,
    minSlides: 2,
    maxSlides: 3,
    slideMargin: 10
  });
});

function addExSearch(name,key,uri){
	$("#UI_EX").fadeIn();
	$("#cache_exsearch").fadeIn();
	$("#bxslider-list").fadeIn();
	tmp = document.getElementById("rawSAkey").innerHTML;
	if(encodeURIComponent(tmp)=="%0A"){
		$("#rawSAkey").html('');
		$("#rawSAname").html('');
	}
	$("#rawSAkey").append(" "+key);
	$("#rawSAname").append(":"+decodeURIComponent(name));
	str = '<li ><span id="popup-close" title="Close">x</span> <div class="image_title">'+
				'<a href="#" onclick="showPopup(\''+uri+'\');">'+decodeURIComponent(name)+'</a>'+
			'</div>'+
			'<a href="#">'+
				'<img src="images/3yiC6Yq.jpg"/>'+
			'</a>'+
		'</li>';	
	//$("#keySA").append(str);	
	classname = key.replace("http://data.linkedmdb.org/resource/","");
	classname = classname.replace("\/","_");
	$("#bxslider").append('<li class="'+classname+'" onclick="showPopupSimple(\''+uri+'\',\''+key+'\');"> <img src="http://placehold.it/350x110/9b59b6/ffffff/&text='+decodeURIComponent(name)+'"></li>');
	//var slider =  $("#bxslider").bxSlider();
	slider.reloadSlider();
}
function deleteKeyExSearch(){

	if(slider.getSlideCount()==1){
		clearExSearch();
		$('div#popup-bg').fadeOut(500);
		$('div#popup').fadeOut(500);
		return;
	}
	var key = $("#popup-content-uri").html();
	var tmp = $("#rawSAkey").html();
	tmp = tmp.replace(" "+key,"");
	$("#rawSAkey").html(tmp);
	//alert($("#rawSAkey").html());
	var classname = key.replace("http://data.linkedmdb.org/resource/","");
	classname = "."+classname.replace("\/","_");
	$('div#popup-bg').fadeOut(500);
	$('div#popup').fadeOut(500);
	$(classname).remove();
	slider.reloadSlider();
}
function clearExSearch(){
	$("#UI_EX").fadeOut();
	$("#cache_exsearch").fadeOut();
	$("#bxslider-list").fadeOut();
	slider.destroySlider();
	$("#bxslider").html("");
	document.getElementById("rawSAkey").innerHTML="";
	document.getElementById("rawSAname").innerHTML="";
	document.getElementById("keySA").innerHTML="";
}
function showPopup1(uri,key){	
			$("#top-content-name").html('');
			$("#popup-content").fadeIn();
			$("#cssmenu").fadeOut();
		  $("div#popup-content").html('<div class="loading1"><div></div><div></div><div></div><div></div><div></div></div></div>');
		   $.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: 'json',
								beforeSend: function (jqXHR) {
										jqXHR.key = key;
									},
				success:function(data,textStatus, jqXHR){
				$("#cssmenu").fadeIn();
				$("#cssmenuWhy").hide();
				var name,img,type,des;
												type="";												
				if(data.property['/type/object/name']!= undefined )
					name = data.property['/type/object/name'].values[0].text;
				else name="";
				if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
				else type="...";
				if(data.property['/common/topic/description']!= undefined )
					des = data.property['/common/topic/description'].values[0].value;
				else des="...";
				if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
				if(name!="")
					str = '<li><div class="post-info">'
					+img
					+'<div class="post-basic-info">'
					+'	<span><a href="#">'+type+'</a></span>'
					+'	<p>'+des+'</p>'
					+'</div>'
					+'</div>'
					+'</li>';
					else str="";
				$("#popup-name").html(name);	
				$("#popup-content").html(str);
				$("#top-content-name").html(name);
				$("#popup-content-uri").html(jqXHR.key);
				drawgraph();
				}
				});	
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		bg.animate({opacity:0.2},0).fadeIn(500); 
		obj.fadeIn(500).absoluteCenter(); 
		btnClose.click(function(){
			bg.fadeOut(500);
			obj.fadeOut(500);
		});
		bg.click(function(){
			btnClose.click(); 
		});
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); 
			}
		});
}
function showPopup(uri){

$("div#popup-content").html('<div class="loading1"><div></div><div></div><div></div><div></div><div></div></div></div>');
		  /* var topic_id = '/guid/9202a8c04000641f8000000000034e87';
		  topic_id=uri;
		  var service_url = 'https://www.googleapis.com/freebase/v1/topic';
		  var params = {};
		  $.getJSON(service_url + topic_id + '?callback=?', params, function(topic) {
						$("div#popup-content").html('');	
			$('<div>',{text:topic.property['/common/topic/description'].values[0].value}).appendTo("div#popup-content");
			//$('<div>',{text:topic.property['/type/object/name'].values[0].text}).appendTo("div#popup-header");
		  }); */
		   $.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: 'json',
				success:function(data){
				$("#cssmenu").fadeIn();
				var name,img,type,des;
												type="";												
				if(data.property['/type/object/name']!= undefined )
					name = data.property['/type/object/name'].values[0].text;
				else name="";
				if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
				else type="...";
				if(data.property['/common/topic/description']!= undefined )
					des = data.property['/common/topic/description'].values[0].value;
				else des="...";
				if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
				if(name!="")
					str = '<li><div class="post-info">'
					+img
					+'<div class="post-basic-info">'
					+'	<span><a href="#">'+type+'</a></span>'
					+'	<p>'+des+'</p>'
					+'</div>'
					+'</div>'
					+'</li>';
					else str="";
				$("#popup-name").html(name);	
				$("#popup-content").html(str);
				$("#top-content-name").html(name);

				drawgraph();
				}
				});	
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		bg.animate({opacity:0.2},0).fadeIn(500); 
		obj.fadeIn(500).absoluteCenter(); 
		btnClose.click(function(){
			$("#cssmenu").fadeOut();
			bg.fadeOut(500);
			obj.fadeOut(500);
		});
		bg.click(function(){
			btnClose.click(); 
		});
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); 
			}
		});
}

function showPopupEX(uri,key,mainKey){
		$("#top-content-name").html('');
			$("#cssmenu").fadeOut();
			$("#popup-content").fadeIn();
		$("div#popup-content").html('<div class="loading1"><div></div><div></div><div></div><div></div><div></div></div></div>');
		   $.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: 'json',
				beforeSend: function (jqXHR) {
					jqXHR.key = key;
					jqXHR.mainKey = mainKey
				},
				success:function(data, textStatus, jqXHR){				
				//if(jqXHR.key!=""){
				//$("#popup-content").html("<div id='canvas'></div>");
				//drawgraph1(jqXHR.key);
				//}
				//else
					$("#cssmenu").fadeIn();					
					$("#cssmenuWhy").show();
					$("#popup-content").html("");
				var name,img,type,des;
												type="";												
				if(data.property['/type/object/name']!= undefined )
					name = data.property['/type/object/name'].values[0].text;
				else name="";
				if(data.property['/type/object/type']!= undefined ){
					for(var k=0;k<data.property['/type/object/type'].values.length;k++){
						var tmp = data.property['/type/object/type'].values[k].text;
						if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
						(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
						(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
							if(type=="")
								type = type +"\""+ tmp +"\"";
							else
								type = type +"-\""+ tmp +"\"";
					}
				}
				else type="...";
				if(data.property['/common/topic/description']!= undefined )
					des = data.property['/common/topic/description'].values[0].value;
				else des="...";
				if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 

				if(name!="")
					str = '<li><div class="post-info">'
					+img
					+'<div class="post-basic-info">'
					+'	<span><a href="#">'+type+'</a></span>'
					+'	<p>'+des+'</p>'
					+'</div>'
					+'</div>'
					+'</li>';
					else str="";
					if($("#numEXKey").html()=="1"){
					var why=jqXHR.key.replace("http://data.linkedmdb.org/resource/","");
					var ind = parseInt(why.indexOf("\/"));
					why = why.slice(0,ind);
					why = why +" of";
					var arrtmp = [];
					arrtmp.push({key1:jqXHR.key,key:jqXHR.mainKey,value:why});
					var json = JSON.stringify(arrtmp);
					$("#RelateArr").html(json);
					}
				$("#popup-name").html(name);	
				$("#popup-content").html(str);
				$("#top-content-name").html(name);
				$("#popup-why-name").html("Why "+name+" is recomended?");
				$("#popup-content-uri").html(jqXHR.key);
				drawgraph(jqXHR.key);
				}
				});	 
				
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		bg.animate({opacity:0.2},0).fadeIn(500); 
		obj.fadeIn(500).absoluteCenter(); 
		btnClose.click(function(){
			bg.fadeOut(500);
			obj.fadeOut(500);
		});
		bg.click(function(){
			btnClose.click(); 
		});
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); 
			}
		});	
			
}

function showPopupSimple(uri,key){
		$("#top-content-name").html('');
			$("#cssmenu").fadeOut();
			$("#popup-content").fadeIn();
		  $("div#popup-content").html('<div class="loading1"><div></div><div></div><div></div><div></div><div></div></div></div>');
		   $.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: 'json',
								beforeSend: function (jqXHR) {
										jqXHR.key = key;
									},
				success:function(data,textStatus, jqXHR){
				$("#cssmenu").fadeIn();
				$("#cssmenuWhy").hide();
				$("#cssmenuDelete").show();
				var name,img,type,des;
												type="";												
				if(data.property['/type/object/name']!= undefined )
					name = data.property['/type/object/name'].values[0].text;
				else name="";
				if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
				else type="...";
				if(data.property['/common/topic/description']!= undefined )
					des = data.property['/common/topic/description'].values[0].value;
				else des="...";
				if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
				if(name!="")
					str = '<li><div class="post-info">'
					+img
					+'<div class="post-basic-info">'
					+'	<span><a href="#">'+type+'</a></span>'
					+'	<p>'+des+'</p>'
					+'</div>'
					+'</div>'
					+'</li>';
					else str="";
				$("#popup-name").html(name);	
				$("#popup-content").html(str);
				$("#top-content-name").html(name);
				$("#popup-content-uri").html(jqXHR.key);
				drawgraph();
				}
				});	
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		bg.animate({opacity:0.2},0).fadeIn(500); 
		obj.fadeIn(500).absoluteCenter(); 
		btnClose.click(function(){
			$("#cssmenuDelete").fadeOut(500);
			bg.fadeOut(500);
			obj.fadeOut(500);
		});
		bg.click(function(){
			btnClose.click(); 
		});
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); 
			}
		});
}

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}

function MaxAB(a,b){
		if(a>b)
			return a;
		return b;	
	}
	function MinAB(a,b){
		if(a<b)
			return a;
		return b;	
	}
	function RelateMeasure(A,B,AB){
	
		W= 279676;
		//$b=SearchA($uriB);
		//$a=SearchA($uriA);
		return (Math.log(MaxAB(A,B))-Math.log(AB))/(Math.log(W)-Math.log(MinAB(A,B)));
	}
	function RelateMeasureWiki(T){
	
		W= 279676;
		return Math.log(W/T);
	}
	function getKeyValueArray(key,arr){
		for(var i=0;i<arr.length;i++)
			if(arr[i].key==key)
				return arr[i].value;
		return 0;
	}

function sortStringDesc(a1, a2){
          return (a1.value>a2.value ? -1 : (a1.value < a2.value ? 1 : 0));
     }
	 
function exSearch(type_ex){
	var arrPropertyGraph = [];
	var arrNameGraph = [];
	var pivot = [];
	var arrA = [];
	var arrAB = [];
	var relatedAB = [];
	var arrNameA = [];
	var arrNameB =[];
	var arrNamePivot = [];
	var arrPivot = [];
	var arrShow = [];
	var arrIMDB = [];
	var countAB = 0;
	var countA = 0;
			if(type_ex!=11&&type_ex!=10){
			$("#startDepth").html("");
				$("#rawtop").html("");
				$("#rawfast").html("");
				$("#rawwiki").html("");
				$("#rawrecommend").html("");
				$("#topsearch").html('');
				$("#fastsearch").html('');
				$("#allsearch").html('');
				$("#numEXKey").html("");
				$("#propertyGraph").html("");
				$("#nameGraph").html("");
				}
	str = document.getElementById("rawSAkey").innerHTML;
	nameStr = $("#rawSAname").html();
	var mode = $("#entities").val();
	var	depth = $("#depth").val();
	/*if(mode=="1"&&depth=="2"){
		showPopupWating("Sorry! This feature is coming soon");
		return;
		return;
	}
	else if(mode=="2"&&depth=="2"){
		showPopupWating("Sorry! This feature is coming soon");
		return;
		return;
	}*/
	var range = $("#range").val();
	var check = document.getElementById("istest");
   // if(check.checked == true)
	if(type_ex==1){
		str = " "+$("#popup-content-uri").html();
		$('div#popup-bg').fadeOut(500);
		$('div#popup').fadeOut(500);
		}
	//str = " http://data.linkedmdb.org/resource/film/72";
	//str = " http://data.linkedmdb.org/resource/actor/29852 http://data.linkedmdb.org/resource/actor/29851";
	//str = " http://data.linkedmdb.org/resource/film/837 http://data.linkedmdb.org/resource/film/2115 http://data.linkedmdb.org/resource/actor/57";
	//neu khong add gi vao thi se yeu cau them dau vao
	if(encodeURIComponent(str)=="%0A"){
		alert("Please Select SA key");
			return;
	}
	
	document.getElementById("more").style.display = 'none';
	document.getElementById("abc").style.marginTop = "10%";
	$("#abc").fadeOut();
	


	$("#loading").fadeIn("slow");
	$("#keySA").fadeOut();
	var res = str.split(" ");

	if(type_ex==11&&res.length>=3){
		res[1]=$("#depthKey").html();
		res[2]=$("#depthKey1").html();
	}if(type_ex==10){
		res[1]=$("#depthKey").html();
	}	
		alert(JSON.stringify(res));
	var resName = nameStr.split(":");
	var query ="";
	prefix ="http://www.linkedmdb.org/sparql?query=PREFIX+owl%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0D%0APREFIX+xsd%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0D%0APREFIX+rdfs%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+rdf%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F1999%2F02%2F22-rdf-syntax-ns%23%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0APREFIX+oddlinker%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Foddlinker%2F%3E%0D%0APREFIX+map%3A+%3Cfile%3A%2FC%3A%2Fd2r-server-0.4%2Fmapping.n3%23%3E%0D%0APREFIX+db%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2F%3E%0D%0APREFIX+dbpedia%3A+%3Chttp%3A%2F%2Fdbpedia.org%2Fproperty%2F%3E%0D%0APREFIX+skos%3A+%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0D%0APREFIX+dc%3A+%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Fterms%2F%3E%0D%0APREFIX+movie%3A+%3Chttp%3A%2F%2Fdata.linkedmdb.org%2Fresource%2Fmovie%2F%3E%0D%0A";
	//tim kiem voi cac thuoc tinh cua thuc the dau tien
	if(mode=="1"){	
	 query = "SELECT distinct ?o WHERE {{<"+res[1]+"> ?p ?o} UNION {?o ?p <"+res[1]+">}}";
	 $("#PivotKey").html(res[1]);
	}
	
	else if(mode=="2"){		
	var tmp="";
	$("#PivotKey").html('');
		for(var i=1;i<res.length;i++){
			if(i==3) break;
			if(i==1)
				tmp=tmp+"{<"+res[i]+"> ?p ?o} UNION {?o ?p <"+res[i]+">}";
			else
				tmp=tmp+" UNION {<"+res[i]+"> ?p ?o} UNION {?o ?p <"+res[i]+">}";
				}
		  query = "SELECT distinct ?o WHERE {"+tmp+"}";
		  $("#PivotKey").append(" "+res[i]);
			  
	}
	
	var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
	//tim kiem cac thuoc tinh cua thuc the dau tien
	$.ajax({
    type:     "GET",
    url:      uri, // <-- Here
    dataType: "jsonp",
    success: function(data){						
		var arr = data['results']['bindings'];
	   //$("#loading").fadeOut("slow");
	   //$("#abc").fadeIn();
	
		//$("#top_box").show();
		//$("#all_box").show();
		
		$("#keySA").fadeIn();
		//xac dinh cac thuoc tinh la thuc the hay URI
		for(i=0;i<arr.length;i++){
			if(arr[i]['o']['type']=="uri")
				if((arr[i]['o']['value'].search("linkedmdb")!=-1)&&(arr[i]['o']['value'].search("interlink")==-1)
				&&(arr[i]['o']['value'].search("film_film_distributor_relationship")==-1)){
					tmp = arr[i]['o']['value'];
					pivot.push({key:tmp,value:tmp});
				}
		}
		//Tinh trong so cua cac thuoc tinh cua thuc the dau tien do
		for(i=1;i<res.length;i++){
		query = "SELECT  (COUNT(distinct ?s) AS ?count) WHERE{ {?s ?o <"+res[i]+">} UNION {<"+res[i]+"> ?o ?s}}";
						uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
						  $.ajax({
								type:     "GET",
								url:      uri, // <-- Here
								dataType: "jsonp",
								beforeSend: function (jqXHR) {
										jqXHR.key = res[i];
									},
								success:function(data, textStatus, jqXHR){	
									var key = jqXHR.key;
									if(data['results']['bindings'].length>0){	
									var count = data['results']['bindings'][0]['count']['value'];
									arrPivot.push({key:key,value:count});
					}
									 } 
								});
		}
		//In ten cua cac thuc the dau vao
		for(i=1;i<res.length;i++){
					query = "SELECT * WHERE {<"+res[i]+"> rdfs:label ?name}";
					uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						beforeSend: function (jqXHR) {
								jqXHR.key = res[i];
							},
						success:function(data, textStatus, jqXHR){
							arrNameGraph.push({key:jqXHR.key,value:data['results']['bindings'][0]['name']['value']});
									$("#nameGraph").html(JSON.stringify(arrNameGraph));
						}
					});
					//Ghi nhan tat ca cac thuoc tinh
					query = "SELECT distinct ?o WHERE {{<"+res[i]+"> ?p ?o} UNION {?o ?p <"+res[i]+">}}";
					var uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						beforeSend: function (jqXHR) {
								jqXHR.key = res[i];
							},
						success: function(data, textStatus, jqXHR){						
							var arr = data['results']['bindings'];
							//xac dinh cac thuoc tinh la thuc the hay URI
							for(i=0;i<arr.length;i++){
								if(arr[i]['o']['type']=="uri")
									if((arr[i]['o']['value'].search("linkedmdb")!=-1)&&(arr[i]['o']['value'].search("interlink")==-1)
									&&(arr[i]['o']['value'].search("film_film_distributor_relationship")==-1)){
										tmp = arr[i]['o']['value'];
										arrPropertyGraph.push({key:jqXHR.key,property:tmp});
										$("#propertyGraph").html(JSON.stringify(arrPropertyGraph));
									}
							}
						}
					});
		}
		//Neu chi co 1 thuc the tim kiem thi dua ra cac thuoc tinh cua thuc the do
		if(res.length==2){
		$("#numEXKey").html(1);
		            var count2=0;
            var countb=0,counta=0;
			for(var j=0;j<pivot.length;j++){
			
						query = "SELECT * WHERE {<"+pivot[j].key+"> foaf:page ?url}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
				//Hien thi thong tin
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						beforeSend: function (jqXHR) {
								jqXHR.key = pivot[j].key;
								jqXHR.mainName = resName[1];
								jqXHR.mainKey = res[1];
							},
						success:function(data, textStatus, jqXHR){						
						var key = jqXHR.key;
						var mainName = jqXHR.mainName;
						if(data == undefined) return;
						var arr = data['results']['bindings'];						
						 for(var i=0;i<arr.length;i++){
						 //xac dinh cac thuc the la film, tinh muc do diem so de goi y dua vao imdb
						 if(arr[i]['url']['value'].search("imdb.com")!=-1){
							var page = arr[i]["url"]["value"].replace("http://www.imdb.com/title/","");
							page = page.replace("/","");
							var uri = "http://www.omdbapi.com/?i="+page+"&r=json"; 
							$.ajax({
										type:     "GET",
										url:      uri, // <-- Here
										dataType: 'json',
										beforeSend: function (jqXHR) {
											jqXHR.key=key;
										},
										success:function(data, textStatus, jqXHR){
											var x = parseInt(data["imdbRating"]);
											arrIMDB.push({vote:x,page:arr[0]['url']['value'],key:jqXHR.key});
										}
							});}
						//hien thi thong tin chi tiet	
							if(arr[i]['url']['value'].search("freebase")!=-1){
								var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
								var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
								$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: 'json',
									beforeSend: function (jqXHR) {
										jqXHR.uri = uri;
										jqXHR.key = key;
										jqXHR.mainName = mainName;
										jqXHR.mainKey = res[1];
									},
									success:function(data, textStatus, jqXHR){	
										var name,img,type,des;
										type="";
										if(data.property['/type/object/name']!= undefined )
											name = data.property['/type/object/name'].values[0].text;
										else name="";
										if(data.property['/type/object/type']!= undefined ){
											for(var k=0;k<data.property['/type/object/type'].values.length;k++){
												var tmp = data.property['/type/object/type'].values[k].text;
												if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
												(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
												(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
													if(type=="")
														type = type +"\""+ tmp +"\"";
													else
														type = type +"-\""+ tmp +"\"";
											}
										}
										else type="...";
										if(data.property['/common/topic/description']!= undefined )
											des = data.property['/common/topic/description'].values[0].text;
										else des="...";
										if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
										
										var why=jqXHR.key.replace("http://data.linkedmdb.org/resource/","");
										var ind = parseInt(why.indexOf("\/"));
										why = why.slice(0,ind)+" of "+jqXHR.mainName;
										
										if(name!=""){
											str = '<li><div class="post-info">'
											+img
											+'<div class="post-basic-info">'
											+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\',\''+jqXHR.mainKey+'\');" >'+name+'</a>'
											+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
											+'	<span><a href="#"><label> </label>'+type+'</a></span>'
											+'	<p>'+des+'</p>'
											+'</div>'
											+'</div>'
												+'</li>';
											arrNameB.push({key:jqXHR.key,value:name});	
											}
										else str="";
									
									//Neu co nhieu hon mot bo phim thi sap xep theo thu tu giam dan de hien thi	
									/*count2++;
									if(count2==(pivot.length-1)){
										if(arrIMDB.length>=2){
											  for(var i=0;i<arrIMDB.length;i++)												
											  for(var j=i+1;j<arrIMDB.length;j++)
												 if(arrIMDB[i].vote<arrIMDB[j].vote){
														 var tmp = arrIMDB[i].vote;
														arrIMDB[i].vote = arrIMDB[j].vote;
														arrIMDB[j].vote= tmp; 
													}
											for(var i=0;i<3;i++){
												if(arrIMDB[i].page!=undefined){
											var page = arrIMDB[i].page.replace("http://www.freebase.com/view","");
											var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
											$.ajax({
												type:     "GET",
												url:      uri, // <-- Here
												dataType: 'json',
												beforeSend: function (jqXHR) {
																jqXHR.uri = uri;
																jqXHR.key = arrIMDB[i].key;
												},
												success:function(data, textStatus, jqXHR){
												 var name,img,type,des;
												type="";
												 if(data.property['/type/object/name']!= undefined )
																name = data.property['/type/object/name'].values[0].text;
															else name="";
															if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
															else type="...";
														if(data.property['/common/topic/description']!= undefined )
																des = data.property['/common/topic/description'].values[0].text;
															else des="...";
													  if(data.property['/common/topic/image']!= undefined )
																img ='<img src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/>';
															else img="";  
															if(name!=""){
													str = '<li><div class="post-info">'
														+img
														+'<div class="post-basic-info">'
														+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
														+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
														+'	<span><a href="#"><label> </label>'+type+'</a></span>'
														+'	<p>'+des+'</p>'
														+'</div>'
														+'</div>'
															+'</li>'; 
														}
													else str="";
													$("#topsearch").append(str);									
												} 
											});	
												}
											}											
											
											 }
									
									}*/
									arrNameGraph.push({key:key,value:name});
									$("#nameGraph").html(JSON.stringify(arrNameGraph));
									$("#loading").fadeOut("slow");
									   $("#abc").fadeIn();
										$("#top_box").fadeIn();
										$("#all_box").fadeIn();
										//Phan top hien cac thong tin lien quan den film
										//Phan recommend hien tat cac cac thong tin
									 if((type.search("\"Film\"")!=-1)||(type.search("actor")!=-1)||
									(type.search("editor")!=-1)||(type.search("writer")!=-1)||
									(type.search("director")!=-1)||(type.search("producer")!=-1))
										if(img!="")
											$("#topsearch").prepend(str);
										else
											$("#topsearch").append(str);
									if(img!="")
										$("#allsearch").prepend(str);
									else
										$("#allsearch").append(str);								
									} 
								});	
							}
							}
						}
						});	
			}
		}
		//Neu co hai thuc the tro len thi thuc hien lan truyen
		var countre=0;
		if(res.length>2)
		for(i=2;i<res.length;i++){
			for(j=0;j<pivot.length;j++){
			
		query = "SELECT  (COUNT(distinct ?s) AS ?count) WHERE{ {{?s ?o <"+res[i]+">} UNION {<"+res[i]+"> ?o ?s}}.{{?s ?o <"+pivot[j].key+">} UNION {<"+pivot[j].key+"> ?o ?s}}}";
		uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
		  $.ajax({
				type:     "GET",
				url:      uri, // <-- Here
				dataType: "jsonp",
				beforeSend: function (jqXHR) {
                        jqXHR.uri1 = res[i];
						jqXHR.uri2 = pivot[j].key;
                    },
				success:function(data, textStatus, jqXHR){
					var uri1 = jqXHR.uri1; 
					var uri2 = jqXHR.uri2; 
					countre+=1;
					if(countre==((res.length-2)*pivot.length))
						alert("ok");
					//Kiem tra neu co quan he ngu nghia thi dua vao top
					if(data['results']['bindings']!=undefined)
					if(data['results']['bindings'].length>0){
					var count = data['results']['bindings'][0]['count']['value'];
					arrAB.push({key:uri1,key1:uri2,value:count});
					countAB+=1;			
					
					//Dua vao fast box nhung thuc the co quan he, khong sap xep chung		
						query = "SELECT * WHERE {<"+uri2+"> foaf:page ?url}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
				//$("#functionAResult").append(uri+"tg</br");
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						beforeSend: function (jqXHR) {
								jqXHR.key = uri2;
							},
						success:function(data, textStatus, jqXHR){
						var key = jqXHR.key;
						var arr = data['results']['bindings'];
						 for(var i=0;i<arr.length;i++)
							if(arr[i]['url']['value'].search("freebase")!=-1){
								var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
								var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
								$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: 'json',
									beforeSend: function (jqXHR) {
													jqXHR.uri = uri;
													jqXHR.key = key;
									},
									success:function(data, textStatus, jqXHR){	
									$("#keySA").fadeIn();
									var name,img,type,des;
												type="";
									if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="...";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												if(name!=""){
										str = '<li><div class="post-info">'
											+img
											+'<div class="post-basic-info">'
											+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
											+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
											+'	<span><a href="#"><label> </label>'+type+'</a></span>'
											+'	<p>'+des+'</p>'
											+'</div>'
											+'</div>'
												+'</li>';
											arrNameB.push({key:jqXHR.key,value:name});
										//	alert(name);
										//alert(JSON.stringify(arrNameB));	
											}
										else str="";
										arrNameGraph.push({key:key,value:name});
									$("#nameGraph").html(JSON.stringify(arrNameGraph));
										$("#loading").fadeOut("slow");
										   $("#abc").fadeIn();
											$("#fast_box").fadeIn();
									var rawtmp = $("#rawfast").html();
										if(rawtmp.search(jqXHR.key)==-1){
													
													if(img!="")
										$("#fastsearch").prepend(str);
									else
										$("#fastsearch").append(str);	
													$("#rawfast").append(" "+jqXHR.key);
													}							
												} 
																	
									 
								});	
							}
						}
						});

							//tinh toan quan he ngu nghia. can tinh so lan xuat hien cua cac property
				query = "SELECT  (COUNT(distinct ?s) AS ?count) WHERE{ {?s ?o <"+uri2+">} UNION {<"+uri2+"> ?o ?s}}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";
						if(getKeyValueArray(uri2,arrA)==0)
						  $.ajax({
								type:     "GET",
								url:      uri, // <-- Here
								dataType: "jsonp",
								beforeSend: function (jqXHR) {
										jqXHR.key = uri2;
									},
								success:function(data, textStatus, jqXHR){
								if(data['results']['bindings']!=undefined)
									if(data['results']['bindings'].length>0){	
									var count = data['results']['bindings'][0]['count']['value'];
									arrA.push({key:jqXHR.key,value:count});
									countA +=1;
									if(countA==countAB){
										for(var i=0;i<arrAB.length;i++){
											relatedAB.push({key:arrAB[i].key,key1:arrAB[i].key1,value:RelateMeasure(getKeyValueArray(arrAB[i].key,arrPivot),getKeyValueArray(arrAB[i].key1,arrA),arrAB[i].value),value1:RelateMeasureWiki(getKeyValueArray(arrAB[i].key1,arrA))});										
										}
										//Sap xep theo moi quan he ngu nghia cua cong thuc google
										for(var i=0;i<relatedAB.length;i++)
											for(var j=i+1;j<relatedAB.length;j++)
												if(relatedAB[i].value<relatedAB[j].value){
													var t = relatedAB[i];
													relatedAB[i]=relatedAB[j];
													relatedAB[j]=t;
												}
										var wikiRelatedAB = relatedAB;
										for(var i=0;i<wikiRelatedAB.length;i++)
											for(var j=i+1;j<wikiRelatedAB.length;j++)
												if(wikiRelatedAB[i].value1<wikiRelatedAB[j].value1){
													var t = wikiRelatedAB[i];
													wikiRelatedAB[i]=wikiRelatedAB[j];
													wikiRelatedAB[j]=t;
												}
										
										alert(JSON.stringify(wikiRelatedAB));
										
									for(var i=0;i<relatedAB.length;i++)
											{
												query = "SELECT * WHERE {<"+relatedAB[i].key1+"> foaf:page ?url}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						async:false,
						beforeSend: function (jqXHR) {
								jqXHR.key = relatedAB[i].key1;
							},
						success:function(data, textStatus, jqXHR){
						var key = jqXHR.key;
						var arr = data['results']['bindings'];
						 for(var i=0;i<arr.length;i++)
							if(arr[i]['url']['value'].search("freebase")!=-1){
								var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
								var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
								$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: 'json',
									beforeSend: function (jqXHR) {
													jqXHR.uri = uri;
													jqXHR.key = key;
									},
									success:function(data, textStatus, jqXHR){	
									$("#keySA").fadeIn();
									var name,img,type,des;
												type="";
									if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="...";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												if(name!=""){
										str = '<li><div class="post-info">'
											+img
											+'<div class="post-basic-info">'
											+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
											+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
											+'	<span><a href="#"><label> </label>'+type+'</a></span>'
											+'	<p>'+des+'</p>'
											+'</div>'
											+'</div>'
												+'</li>';
											arrNameB.push({key:jqXHR.key,value:name});
											}
										else str="";
										arrNameGraph.push({key:key,value:name});
									$("#nameGraph").html(JSON.stringify(arrNameGraph));
										$("#loading").fadeOut("slow");
										$("#abc").fadeIn();
										$("#top_box").fadeIn();
									var rawtmp = $("#rawtop").html();
										if(rawtmp.search(jqXHR.key)==-1){
													
													if(img!="")
										$("#topsearch").prepend(str);
									else
										$("#topsearch").append(str);	
													$("#rawtop").append(" "+jqXHR.key);
													}							
												} 
																	
									 
								});	
							}
						}
						});	}
								for(var i=0;i<wikiRelatedAB.length;i++)
											{
												query = "SELECT * WHERE {<"+wikiRelatedAB[i].key1+"> foaf:page ?url}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						async:false,
						beforeSend: function (jqXHR) {
								jqXHR.key = wikiRelatedAB[i].key1;
							},
						success:function(data, textStatus, jqXHR){
						var key = jqXHR.key;
						var arr = data['results']['bindings'];
						 for(var i=0;i<arr.length;i++)
							if(arr[i]['url']['value'].search("freebase")!=-1){
								var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
								var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
								$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: 'json',
									beforeSend: function (jqXHR) {
													jqXHR.uri = uri;
													jqXHR.key = key;
									},
									success:function(data, textStatus, jqXHR){	
									$("#keySA").fadeIn();
									var name,img,type,des;
												type="";
									if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="...";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												if(name!=""){
										str = '<li><div class="post-info">'
											+img
											+'<div class="post-basic-info">'
											+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
											+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
											+'	<span><a href="#"><label> </label>'+type+'</a></span>'
											+'	<p>'+des+'</p>'
											+'</div>'
											+'</div>'
												+'</li>';
											arrNameB.push({key:jqXHR.key,value:name});
											}
										else str="";
										arrNameGraph.push({key:key,value:name});
									$("#loading").fadeOut("slow");
										$("#abc").fadeIn();
										$("#wiki_box").fadeIn();
									var rawtmp = $("#rawwiki").html();
										if(rawtmp.search(jqXHR.key)==-1){									
										$("#wikisearch").append(str);	
													$("#rawwiki").append(" "+jqXHR.key);
													}							
												} 
																	
									 
								});	
							}
						}
						});	}
									 if(depth==2){
										
										if($("#startDepth").html()!="ok"){
										//alert("acb"+relatedAB.length);
											$("#depthKey").html('');
											$("#depthKey1").html('');
											if(relatedAB.length>=2){

												$("#depthKey").append(relatedAB[0].key1);
												$("#depthKey1").append(relatedAB[1].key1);
												$("#startDepth").html("ok");
												exSearch(11);
											}
											else if(relatedAB.length==1){
												$("#depthKey").append(relatedAB[0].key1);
												$("#startDepth").html("ok");
												exSearch(10);
											}
											else return;	
										}
										}
										var json = JSON.stringify(relatedAB);
											$("#RelateArr").html(json);
											alert(json);
										}
									
									}
									
									 } 
								});	
					}
				//Kiem tra neu khong co quan he ngu nghia thi dua vao all	
					else{
						query = "SELECT * WHERE {<"+uri2+"> foaf:page ?url}";
				uri = prefix+encodeURIComponent(query).replace(/%20/g,'+')+"&output=json";	
					$.ajax({
						type:     "GET",
						url:      uri, // <-- Here
						dataType: "jsonp",
						beforeSend: function (jqXHR) {
								jqXHR.key = uri2;
							},
						success:function(data, textStatus, jqXHR){
						var key = jqXHR.key;
						if(data==undefined) return;
						var arr = data['results']['bindings'];
						 for(var i=0;i<arr.length;i++)
							if(arr[i]['url']['value'].search("freebase")!=-1){
								var page = arr[i]["url"]["value"].replace("http://www.freebase.com/view","");
								var uri = "https://www.googleapis.com/freebase/v1/topic"+page+"?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ";
								$.ajax({
									type:     "GET",
									url:      uri, // <-- Here
									dataType: 'json',
									beforeSend: function (jqXHR) {
													jqXHR.uri = uri;
													jqXHR.key = key;
									},
									success:function(data, textStatus, jqXHR){	
									$("#keySA").fadeIn();
									var name,img,type,des;
												type="";
									if(data.property['/type/object/name']!= undefined )
													name = data.property['/type/object/name'].values[0].text;
												else name="";
												if(data.property['/type/object/type']!= undefined ){
														for(var k=0;k<data.property['/type/object/type'].values.length;k++){
															var tmp = data.property['/type/object/type'].values[k].text;
															if((tmp.search("Film")!=-1)||(tmp.search("actor")!=-1)||
															(tmp.search("editor")!=-1)||(tmp.search("writer")!=-1)||
															(tmp.search("director")!=-1)||(tmp.search("producer")!=-1)||(tmp.search("character")!=-1))
															if(type=="")
																type = type +"\""+ tmp +"\"";
															else
																type = type +"-\""+ tmp +"\"";
														}
													}
												else type="...";
												if(data.property['/common/topic/description']!= undefined )
													des = data.property['/common/topic/description'].values[0].text;
												else des="...";
												  if(data.property['/common/topic/image']!= undefined )
													img ='<div class="image_info"><img width=70 height=90 src="https://usercontent.googleapis.com/freebase/v1/image'+data.property['/common/topic/image']['values'][0]['id']+'?key=AIzaSyDZXndLh8k1vpqvtrUPHHVerkEo0Qz98tQ"/></div>';
												else img='<div class="image_info"><img width=70 height=90 src="images/noimage.png"/></div>'; 
												if(name!=""){
										str = '<li><div class="post-info">'
											+img
											+'<div class="post-basic-info">'
											+'	<h3><a href="#" onclick="showPopupEX(\''+jqXHR.uri+'\',\''+jqXHR.key+'\',\''+jqXHR.key+'\');" >'+name+'</a>'
											+'<a href="#"  onclick="addExSearch(\''+encodeURIComponent(name)+'\',\''+jqXHR.key+'\',\''+jqXHR.uri+'\');">Add Seach</a>'
											+'	<span><a href="#"><label> </label>'+type+'</a></span>'
											+'	<p>'+des+'</p>'
											+'</div>'
											+'</div>'
												+'</li>';
											arrNameB.push({key:jqXHR.key,value:name});
										//	alert(name);
										//alert(JSON.stringify(arrNameB));	
											}
										else str="";
										arrNameGraph.push({key:key,value:name});
									$("#nameGraph").html(JSON.stringify(arrNameGraph));
										$("#loading").fadeOut("slow");
										$("#abc").fadeIn();
										$("#all_box").fadeIn();
										var rawtmp = $("#rawrecommend").html();
										if(rawtmp.search(jqXHR.key)==-1){
													
													if(img!="")
														$("#allsearch").prepend(str);
													else
														$("#allsearch").append(str);	
													$("#rawrecommend").append(" "+jqXHR.key);
													}							
												} 
																	
									
								});	
							}
						}
						});						
					}

					} 
				});	 
			}
		} 
		
	}
		
});		
}

function showWhy(){
//showPopupWating("Sorry! This feature is coming soon");
//return;
	$("#popup-content").fadeOut();
	$("#popup-why").fadeIn();
				
			
}

function showPopupWating(string){
		$("#top-content-name").html('');
		$("#cssmenu").fadeOut();
		$("#popup-name").html("Info");	
		var str = '<div id="form-main">'
		  +'<div id="form-div">'
			+'<form class="form" id="form1">'
			  
			  +'<p class="name">'
			+'	<input name="name" type="text" class="validate[required,custom[onlyLetter],length[0,100]] feedback-input" placeholder="Name" id="name" />'
			 +' </p>'
			  
			 +' <p class="email">'
			+'	<input name="email" type="text" class="validate[required,custom[email]] feedback-input" id="email" placeholder="Email" />'
			 +' </p>'
			  
			+'  <p class="text">'
			+'	<textarea name="text" class="validate[required,length[6,300]] feedback-input" id="comment" placeholder="What do you want for this feature"></textarea>'
			+'  </p>'		  
			  
			+'  <div class="submit">'
			+'	<input type="submit" value="SEND" id="button-blue"/>'
			+'	<div class="ease"></div>'
			+'  </div>'
			+'</form>'
		 +'</div>';
		 str='<img src="http://placehold.it/350x110/9b59b6/ffffff/&text=abc">';
		 str='	<div style="color:#d35400; font-size:20px; margin:2%;">Chatbox position Left Down. <br/>Share with us what you want we do for this feature.</div> <img style="margin-left:22%;" src="images/support.png"/>';
		$("#popup-content").html(str);
		$("#top-content-name").html(string);
		//$("#popup-content-uri").html(jqXHR.key);

				
		var bg=$('div#popup-bg');
		var obj=$('div#popup');
		var btnClose=obj.find('#popup-close');
		bg.animate({opacity:0.2},0).fadeIn(500); 
		obj.fadeIn(500).absoluteCenter(); 
		btnClose.click(function(){
			bg.fadeOut(100);
			obj.fadeOut(100);
			$("#cssmenu").fadeIn();
		});
		bg.click(function(){
			btnClose.click(); 
		});
		$(document).keydown(function(e){
			if(e.keyCode==27){
				btnClose.click(); 
			}
		});	
}
function hideWhy(){
	$("#popup-content").fadeIn();
	$("#popup-why").fadeOut();
}
</script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="js/jquery.bxslider.min.js"></script>
    <link href="css/jquery.bxslider.css" rel="stylesheet" />
    <script type="text/javascript">
        
    </script>
	
<script type="text/javascript" src="js/graph/raphael-min.js"></script>
    <script type="text/javascript" src="js/graph/dracula_graffle.js"></script>
    <script type="text/javascript" src="js/graph/dracula_graph.js"></script>
    <script type="text/javascript" src="js/drawgraph.js"></script>	
	</head>
	<body>

		<!---start-wrap---->
			<!---start-header---->
			<div class="header">
				<div class="wrap">

				<div class="nav-icon">
					 <a href="#" class="right_bt" id="activator"><span> </span> </a>
				</div>
      	  
				<div class="top-searchbar" id="top_search" style="display:;">
						<input placeholder="Enter text here..." id="text_search" type="text" onkeydown="if (event.keyCode == 13) search(10)"/><input onclick= "search(10);" type="button" value="" />
						<div>
						<div id="bxslider-list" style="display:none">
								<ul id="bxslider">
								<!-- <li > <img src="http://placehold.it/350x110/9b59b6/ffffff/&text=abc"></li> -->
								</ul>
						</div>
						</div>
				</div>
					<div id = "UI_EX">
							
							<div class="exButton" onclick= "exSearch(0);" ><span>EXSearch<span></div><div  class="clButton" onclick= "clearExSearch();">Clear</div>
							<label>
							<!-- <input type="range" min="0" max="100" value="0" step="50" style="width:40px;" onchange="showValueSlider(this.value)" /> -->
							<script>
								function showValueSlider(newValue)
									{
										document.getElementById("range").value=newValue;
									}
							</script>
							<!-- <input type="number" id="range" value="0" style="width:40px;"/> -->
							<div id="advanceOption">
							<label for="Depth">Depth</label>
							<select id="depth">
							  <option value="1">1</option>
							  <option value="2">2</option>
							</select>
							<label for="male">Entities</label>
							<select id="entities">
							  <option value="1">1</option>
							  <option value="2">2</option>
							</select>
							<!-- <input type="checkbox" id="istest" value="ok">Test<br> -->
						</div>
						</div>
					<ul id="keySA">
					</ul>
				</div>
					
			</div>
		</div>
		<!---//End-header---->
		<!---start-content---->
		<div class="content">

			<div class="wrap">
			 <div id="main" >

<div style="display:none" id="allType">
[{"key":"film_distribution_medium","value":"film distribution medium"},{"key":"film_art_director","value":"film art director"},{"key":"special_film_performance_type","value":"special film performance type"},{"key":"interlink","value":"interlink"},{"key":"film_screening_venue","value":"film screening venue"},{"key":"film_festival","value":"film festival"},{"key":"film_awards_ceremony","value":"film awards ceremony"},{"key":"film_production_designer","value":"film production designer"},{"key":"personal_film_appearance","value":"personal film appearance"},{"key":"film_collection","value":"film collection"},{"key":"film_character","value":"film character"},{"key":"content_rating","value":"content rating"},{"key":"linkage_run","value":"linkage run"},{"key":"country","value":"country"},{"key":"production_company","value":"production company"},{"key":"music_contributor","value":"music contributor"},{"key":"film_cut","value":"film cut"},{"key":"film_format","value":"film format"},{"key":"writer","value":"writer"},{"key":"performance","value":"performance"},{"key":"film_film_company_relationship","value":"film film company relationship"},{"key":"film_job","value":"film job"},{"key":"content_rating_system","value":"content rating system"},{"key":"dubbing_performance","value":"dubbing performance"},{"key":"film_location","value":"film location"},{"key":"film_casting_director","value":"film casting director"},{"key":"film_company","value":"film company"},{"key":"personal_film_appearance_type","value":"personal film appearance type"},{"key":"film_featured_song","value":"film featured song"},{"key":"film_distributor","value":"film distributor"},{"key":"film_series","value":"film series"},{"key":"film_set_designer","value":"film set designer"},{"key":"film_festival_event","value":"film festival event"},{"key":"film_costume_designer","value":"film costume designer"},{"key":"film","value":"film"},{"key":"film_genre","value":"film genre"},{"key":"film_festival_focus","value":"film festival focus"},{"key":"film_crewmember","value":"film crewmember"},{"key":"film_subject","value":"film subject"},{"key":"film_critic","value":"film critic"},{"key":"director","value":"director"},{"key":"film_regional_release_date","value":"film regional release date"},{"key":"film_festival_sponsor","value":"film festival sponsor"},{"key":"film_theorist","value":"film theorist"},{"key":"cinematographer","value":"cinematographer"},{"key":"film_film_distributor_relationship","value":"film film distributor relationship"},{"key":"producer","value":"producer"},{"key":"film_crew_gig","value":"film crew gig"},{"key":"actor","value":"actor"},{"key":"editor","value":"editor"},{"key":"film_story_contributor","value":"film story contributor"}]</div>		
<div style="display:none" id="rawSAkey"></div>
<div style="display:none" id="rawSAname"></div>
<div style="display:none" id="RelateArr"></div>
<div style="display:none" id="PivotKey"></div>
<div id="functionAResult" style="display:"></div>
<div id="functionABResult" style="display:"></div>
<div id="depthKey" style="display:none"></div>
<div id="depthKey1" style="display:none"></div>
<div id="startDepth" style="display:none"></div>
<div id="numEXKey" style="display:none"></div>
<div id="nameGraph" style="display:none"></div>
<div id="propertyGraph" style="display:none"></div>
<script type='text/javascript'>window._sbzq||function(e){e._sbzq=[];var t=e._sbzq;t.push(["_setAccount",4305]);var n=e.location.protocol=="https:"?"https:":"http:";var r=document.createElement("script");r.type="text/javascript";r.async=true;r.src=n+"//static.subiz.com/public/js/loader.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)}(window);</script>

<div id="popup-bg"></div>
<div id="popup">
	<div id="popup-header"><span id="popup-name"></span><span id="popup-close" title="Close">x</span></div>
	<div id="top-content" >
		<div id="top-content-name"></div>
		<div id="popup-content-uri" style="display:none"></div>
		<div id='cssmenu' style="display:none">
		<ul>
		   <li><a href='#' onclick="hideWhy();" ><span>Info</span></a></li>
		   <li><a href='#' id = "cssmenuWhy" onclick="showWhy();"><span>Why it is recomended?</span></a></li>
		   <li><a href='#' onclick="exSearch(1);"><span>Run an exploration</span></a></li>
		   <li><a href='#' id = "cssmenuDelete" style="display:none;background:#f1c40f; color:white;font-weight:bold;" onclick="deleteKeyExSearch();"><span>Delete it?</span></a></li>
		</ul>
		</div>
	</div>
	<div class="fb-comments" data-href="http://exploratorysearch.esy.es/" data-numposts="3" data-colorscheme="dark"></div>
    <div id="popup-content" style="display:;overflow-y: scroll; overflow-x:hidden;  width:700px; height:400px;">
	
	<div class="loading1">
							<div></div>
							<div></div>
							<div></div>
							<div></div>
							<div></div>
						</div></div>
	<div id="popup-why" style="display:">
	
	<div id='popup-why-name' style="color:#d35400; font-size:20px; margin:2%;"></div>
	<div id='canvas' style="padding:2% 4%;"></div>
	</div>	
</div>
					<div id="loading" class="element" style="display: none;">	
<div style="font-family: 'Open Sans', sans-serif; font-weight: bold;font-size: 50px; color:#741bb1; margin-left:-5%">Searching</div>
											
						<div class="loading3">
							<div></div>
							<div></div>
							<div></div>
							<div></div>
							<div></div>
						</div>
					</div>
			      <ul id="abc">
				  <div id="cache_exsearch" style="display:none;">
					</br>
					</br>
					</br>
				  </div>
				  
<div id="searchloading" style="display:none"></div>
				  <div class="box_search" id ="fast_box" style ="display:none; overflow:hidden;">
							<h4 style ="background:#3498db;">FAST</h4>
							<div id ="fastsearch" style="overflow-y: scroll; overflow-x:hidden; width:700px; height:400px;">
						
							</div>
							<div id="rawfast" style ="display:none;"></div>
						</div> 
				  <div class="box_search" id ="top_box" style ="display:none; overflow:hidden;">
							<h4 style ="background:#E74C3C;">TOP</h4>
							<div id ="topsearch" style="overflow-y: scroll; overflow-x:hidden; width:700px; height:400px;">
						
							</div>
							<div id="rawtop" style ="display:none;"></div>
						</div>
					<div class="box_search" id ="wiki_box" style ="display:none; overflow:hidden;">
							<h4 style ="background:#E74C3C;">WIKI SORT</h4>
							<div id ="wikisearch" style="overflow-y: scroll; overflow-x:hidden; width:700px; height:200px;">
						
							</div>
							<div id="rawwiki" style ="display:none;"></div>
						</div>
						
					<div class="box_search" id ="all_box" style ="display:none; overflow:hidden;">
							<h4 style ="background:#1abc9c;">RECOMMEND</h4>
							<div id ="allsearch" style="overflow-y: scroll; overflow-x:hidden;width:700px; height:400px;">
							
							</div>
							<div id="rawrecommend" style ="display:none;"></div>
						</div>
			        <!-- These are our grid blocks -->
			        	<div class="alert-box" class="tooltips">
							<div style="padding: 3%; text-align:left;">
							<h1>Expolatory Search</h1>
							<p> The exploratory search is a new way to search the web, not to find what you are searching, but to find what you are not searching, and might be intersting for you ! It allows performing queries in an innovative way and helps you to navigate rich results. As a hub, it proposes redirections to others platforms to make you benefit from your discoveries</p>
							</div>
							<div style="background:#34495e; padding: 3%; text-align:right;">
							<h1  style="color:white;">Get recommendations on your interests</h1>
							<p style="color:white;"> Want a film recommendation related to actors you like? Want a film recommendation focus to genre you like? Interested by more complex and composite recommendations based on your deepest interests : a actor, a director and a film? Or maybe something simpler ? If you have a thirst for discovery and knowledge, System has answers for you</p>
							</div>
							<div style="padding: 3%; text-align:left;">
							<h1>Understand a recommendation</h1>
							<p> System gives you recommendations, but also tools to understand why you have these recommendations, because we know that the more important in a recommendation is to know why you get it !</p>						
							</div>
						<!-- <a class="a-alert" id="a-start" href="#" onclick="start()" >Get Started</a> -->
						</div>				
						
			        <!-- End of grid blocks -->
			      </ul>
				  
						
				  <div id="more" style="display: none ; margin-left:20%">
				  <a  class="myButton" onclick= "search(0);">Back</a>
				  <a  class="myButton" onclick= "search(1);">Next</a>

				  </div>
			    </div>
			</div>
		</div>
		<!---//End-content---->
		<!----wookmark-scripts---->

		<!----//wookmark-scripts---->
		<!----start-footer--->
		<div class="footer">
			<p>Design by <a href="https://www.facebook.com/dinhduythanh">Đinh Duy Thanh</a></p>
		</div>
		<!----//End-footer--->
		<!---//End-wrap---->
	</body>
</html>

